{"version":3,"sources":["webpack:///./src/views/Comment.vue?f286","webpack:///./src/components/SendComment.vue?f23c","webpack:///src/components/SendComment.vue","webpack:///./src/components/SendComment.vue?49c4","webpack:///./src/components/SendComment.vue","webpack:///./src/components/CommentComponent.vue?7c16","webpack:///src/components/CommentComponent.vue","webpack:///./src/components/CommentComponent.vue?a2e2","webpack:///./src/components/CommentComponent.vue","webpack:///src/views/Comment.vue","webpack:///./src/views/Comment.vue?8c12","webpack:///./src/views/Comment.vue","webpack:///./src/components/CommentComponent.vue?52e9","webpack:///./src/components/SendComment.vue?2e9d"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","playNow","platform","id","comments","initComments","staticRenderFns","class","commentInfo","open","staticClass","commentId","_e","staticStyle","_v","_s","title","nick","directives","name","rawName","value","expression","domProps","on","$event","target","composing","$set","closeComment","clickPlane","component","show","onScroll","_l","t","length","key","toUpperCase","item","user","nickname","getTime","time","content","beReplied","liked","likeComment","numberHandle","likedCount","reply","canDelete","userId","delComment"],"mappings":"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","file":"js/chunk-ca8138d8.442ff5dd.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('CommentComponent',{attrs:{\"platform\":_vm.playNow.platform || '163',\"comment-type\":0,\"id\":_vm.playNow.id,\"comments\":_vm.comments}}),_c('SendComment',{attrs:{\"type\":0,\"platform\":_vm.playNow.platform || '163',\"success-cb\":_vm.initComments}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{class:(\"write-comment-container \" + (_vm.commentInfo.open && 'open'))},[_c('div',{staticClass:\"comment-main\"},[(!_vm.commentInfo.commentId)?_c('div',{staticClass:\"ft_14 pl_5\",staticStyle:{\"color\":\"#fff9\",\"line-height\":\"20px\"}},[_vm._v(\" 为 \"),_c('span',{staticClass:\"comment-title\"},[_vm._v(_vm._s(_vm.commentInfo.title))]),_vm._v(\" 献上评论\")]):_vm._e(),(_vm.commentInfo.commentId)?_c('div',{staticClass:\"ft_14 pl_5\",staticStyle:{\"color\":\"#fff9\",\"line-height\":\"20px\"}},[_vm._v(\" 回复 @\"),_c('span',{staticClass:\"comment-title\"},[_vm._v(_vm._s(_vm.commentInfo.nick))])]):_vm._e(),_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.commentInfo.val),expression:\"commentInfo.val\"}],staticClass:\"comment-input\",attrs:{\"rows\":2,\"placeholder\":\"说些啥呢\"},domProps:{\"value\":(_vm.commentInfo.val)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.commentInfo, \"val\", $event.target.value)}}})]),_c('i',{staticClass:\"iconfont icon-cancel pointer\",on:{\"click\":_vm.closeComment}}),_c('div',{staticClass:\"plane-icon\",on:{\"click\":_vm.clickPlane}},[_c('i',{staticClass:\"iconfont icon-plane pointer\"})])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div :class=\"`write-comment-container ${commentInfo.open && 'open'}`\">\n    <div class=\"comment-main\">\n      <div v-if=\"!commentInfo.commentId\" class=\"ft_14 pl_5\" style=\"color: #fff9; line-height: 20px\"> 为 <span class=\"comment-title\">{{commentInfo.title}}</span> 献上评论</div>\n      <div v-if=\"commentInfo.commentId\" class=\"ft_14 pl_5\" style=\"color: #fff9; line-height: 20px\"> 回复 @<span class=\"comment-title\">{{commentInfo.nick}}</span> </div>\n      <textarea\n        class=\"comment-input\"\n        :rows=\"2\"\n        placeholder=\"说些啥呢\"\n        v-model=\"commentInfo.val\">\n      </textarea>\n    </div>\n    <i class=\"iconfont icon-cancel pointer\" @click=\"closeComment\"></i>\n    <div class=\"plane-icon\" @click=\"clickPlane\">\n      <i class=\"iconfont icon-plane pointer\" />\n    </div>\n  </div>\n</template>\n\n<script>\n  import { mapGetters } from 'vuex';\n  import request from '../assets/utils/request';\n\n  export default {\n    name: \"SendComment\",\n    props: {\n      successCb: Function,\n      type: Number,\n      platform: String,\n    },\n    data() {\n      return {\n        loading: false,\n      }\n    },\n    computed: {\n      ...mapGetters({\n        commentInfo: 'getCommentInfo',\n        playNow: 'getPlaying',\n      })\n    },\n    methods: {\n      clickPlane() {\n        const { commentInfo, platform, type } = this;\n        let trueType = type;\n        let id = 0, title = commentInfo.title;\n        if (commentInfo.open) {\n          // 这里是发送评论\n          if (!commentInfo.val) {\n            return this.$message.warning('无话可说？');\n          } else if (commentInfo.val.length > 300) {\n            return this.$message.warning('话有点多？');\n          } else {\n            if (this.loading) {\n              return;\n            }\n            // 真的要发评论了\n            this.loading = true;\n            if (commentInfo.platform === 'qq') {\n              return request({\n                api: 'QQ_COMMENT_SEND',\n                method: 'post',\n                data: {\n                  id: commentInfo.id,\n                  content: commentInfo.val,\n                  biztype: commentInfo.type,\n                }\n              }).then(() => {\n                this.loading = false;\n                this.successCb();\n              }, () => this.$message.error('评论失败了'));\n            }\n            request({\n              api: 'COMMENT',\n              data: {\n                t: commentInfo.commentId ? 2 : 1,\n                type,\n                id: commentInfo.id,\n                content: commentInfo.val,\n                commentId: commentInfo.commentId,\n              },\n              cache: true,\n            }).then(() => {\n              this.loading = false;\n              this.successCb();\n            }, () => this.$message.error('评论失败了'));\n          }\n        } else {\n          switch (`${platform}-${type}`) {\n            case '163-0':\n              id = this.playNow.id;\n              title = this.playNow.name;\n              break;\n            case 'qq-0':\n              id = this.playNow.songid;\n              title = this.playNow.name;\n              trueType = 1;\n              break;\n          }\n          this.$store.dispatch('updateCommentInfo', { type: trueType, id, title, open: true, platform, success: false, });\n        }\n      },\n      closeComment() {\n        this.$store.dispatch('updateCommentInfo', { open: false });\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  .write-comment-container {\n    position: fixed;\n    bottom: 120px;\n    right: 40px;\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    background: #F23C3C;\n    border: 2px solid #F23C3C;\n    opacity: 0.3;\n    font-size: 0;\n    cursor: pointer;\n    box-shadow: 0 0 20px #333;\n    transition: 0.3s;\n    overflow: hidden;\n    z-index: 10;\n\n    &:hover {\n      opacity: 0.8;\n    }\n\n    &.open {\n      opacity: 0.8;\n      width: calc(40% - 80px);\n      height: 120px;\n      background: #000d;\n      border: 2px solid #fff3;\n      border-radius: 20px;\n      cursor: default;\n      z-index: 10;\n\n      .comment-main, .icon-cancel {\n        opacity: 1;\n      }\n      .plane-icon {\n        bottom: 5px;\n      }\n    }\n\n    .plane-icon {\n      color: #fff;\n      text-align: center;\n      position: absolute;\n      right: 0;\n      bottom: 0;\n      width: 50px;\n      transition: 0.3s;\n\n      .icon-plane {\n        line-height: 50px;\n        font-size: 24px !important;\n      }\n    }\n\n    .icon-cancel {\n      position: absolute;\n      bottom: 80px;\n      right: 20px;\n      color: #fffc;\n      font-size: 14px !important;\n      transition: 0.3s;\n      opacity: 0;\n    }\n\n    .comment-main {\n      position: absolute;\n      right: 65px;\n      bottom: 15px;\n      width: calc(100% - 80px);\n      color: #fffc;\n      transition: 0.3s;\n      opacity: 0;\n\n      .comment-title {\n        display: inline-block;\n        max-width: 150px;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        vertical-align: -6px;\n      }\n\n      .comment-input {\n        background: transparent !important;\n        width: 100%;\n        height: 70px;\n        font-size: 14px;\n        border: none !important;\n        color: #fffc;\n        outline: none !important;\n        resize: none;\n      }\n    }\n  }\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SendComment.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SendComment.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SendComment.vue?vue&type=template&id=fe07b3e8&scoped=true&\"\nimport script from \"./SendComment.vue?vue&type=script&lang=js&\"\nexport * from \"./SendComment.vue?vue&type=script&lang=js&\"\nimport style0 from \"./SendComment.vue?vue&type=style&index=0&id=fe07b3e8&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"fe07b3e8\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{class:(\"comments-page-container \" + (_vm.show && 'show')),on:{\"scroll\":_vm.onScroll}},_vm._l((_vm.type),function(t){return (_vm.comments && (_vm.comments[t].length > 0))?_c('div',{key:(\"list-\" + t),staticClass:\"comment-type-block\"},[_c('div',{staticClass:\"comment-type-title\"},[_vm._v(_vm._s(t.toUpperCase()))]),_c('div',{staticClass:\"comments-list\"},_vm._l((_vm.comments[t]),function(item){return _c('div',{key:item.id,staticClass:\"comment-item\"},[_c('img',{staticClass:\"user-avatar\",attrs:{\"src\":((item.user.avatarUrl) + \"?param=50y50\")}}),_c('div',{staticClass:\"comment-content\"},[_c('div',{staticClass:\"user-name-block\"},[_c('a',{attrs:{\"href\":(\"#/user?id=\" + (item.user.userId))}},[_c('b',{staticClass:\"user-name\"},[_vm._v(_vm._s(item.user.nickname))])]),_c('span',{staticClass:\"pl_20 comment-time\"},[_vm._v(_vm._s(_vm.getTime(item.time)))])]),_c('div',{staticClass:\"content\",domProps:{\"innerHTML\":_vm._s(item.content)}}),(item.beReplied && item.beReplied[0])?_c('blockquote',{staticClass:\"be-replied\"},[_c('a',{staticClass:\"user-name\",attrs:{\"href\":(\"#/user?id=\" + (item.user.userId))}},[_vm._v(\"@\"+_vm._s(item.beReplied[0].user.nickname))]),_vm._v(\"\\n            ：\"),_c('span',{domProps:{\"innerHTML\":_vm._s(item.beReplied[0].content)}})]):_vm._e(),_c('div',{staticClass:\"mt_10\"},[_c('i',{class:(\"iconfont pointer \" + (item.newLike) + \" icon-zan\" + (item.liked ? '' : '-o')),on:{\"click\":function($event){return _vm.likeComment(item, t)}}}),_c('span',{staticClass:\"pl_10 ft_12\"},[_vm._v(_vm._s(_vm.numberHandle(item.likedCount)))]),(_vm.platform === '163')?_c('i',{staticClass:\"iconfont icon-reply ml_20 pointer\",staticStyle:{\"vertical-align\":\"-1px\"},on:{\"click\":function($event){return _vm.reply(item)}}}):_vm._e(),(item.canDelete || (_vm.platform === '163' && item.user.userId === _vm.user.userId))?_c('i',{staticClass:\"iconfont icon-delete ml_20 pointer\",on:{\"click\":function($event){return _vm.delComment(item.commentId)}}}):_vm._e()])])])}),0)]):_vm._e()}),0)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div :class=\"`comments-page-container ${show && 'show'}`\" @scroll=\"onScroll\">\n    <div class=\"comment-type-block\" v-if=\"comments && (comments[t].length > 0)\" v-for=\"t in type\" :key=\"`list-${t}`\">\n      <div class=\"comment-type-title\">{{t.toUpperCase()}}</div>\n      <div class=\"comments-list\">\n        <div class=\"comment-item\" v-for=\"item in comments[t]\" :key=\"item.id\">\n          <img class=\"user-avatar\" :src=\"`${item.user.avatarUrl}?param=50y50`\">\n          <div class=\"comment-content\">\n            <div class=\"user-name-block\">\n              <a :href=\"`#/user?id=${item.user.userId}`\"><b class=\"user-name\">{{item.user.nickname}}</b></a>\n              <span class=\"pl_20 comment-time\">{{getTime(item.time)}}</span>\n            </div>\n            <div class=\"content\" v-html=\"item.content\"></div>\n            <blockquote v-if=\"item.beReplied && item.beReplied[0]\" class=\"be-replied\">\n              <a :href=\"`#/user?id=${item.user.userId}`\" class=\"user-name\">@{{item.beReplied[0].user.nickname}}</a>\n              ：<span v-html=\"item.beReplied[0].content\"></span>\n            </blockquote>\n            <div class=\"mt_10\">\n              <i @click=\"likeComment(item, t)\" :class=\"`iconfont pointer ${item.newLike} icon-zan${item.liked ? '' : '-o'}`\" />\n              <span class=\"pl_10 ft_12\">{{numberHandle(item.likedCount)}}</span>\n              <i v-if=\"platform === '163'\" class=\"iconfont icon-reply ml_20 pointer\" style=\"vertical-align: -1px;\" @click=\"reply(item)\" />\n              <i class=\"iconfont icon-delete ml_20 pointer\" @click=\"delComment(item.commentId)\" v-if=\"item.canDelete || (platform === '163' && item.user.userId === user.userId)\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  import request, { handleQQComments } from '../assets/utils/request';\n  import timer from '../assets/utils/timer';\n  import { numToStr } from \"../assets/utils/stringHelper\";\n  import { mapGetters } from 'vuex';\n  import $ from 'jquery';\n  import Storage from \"../assets/utils/Storage\";\n  export default {\n    name: \"Comment\",\n    props: {\n      commentType: Number,\n      id: Number | String,\n      comments: Object,\n      platform: String,\n    },\n    data() {\n      return {\n        loading: false,\n        show: false,\n        type: ['hot', 'latest'],\n      }\n    },\n    computed: {\n      ...mapGetters({\n        playNow: 'getPlaying',\n        user: 'getUser',\n        playingPercent: 'getPlayingPercent',\n        commentInfo: 'getCommentInfo',\n      })\n    },\n    watch: {\n      commentInfo: {\n        handler(v) {\n          if (v.success) {\n            this.getComments(true);\n          }\n        },\n        deep: true,\n      }\n    },\n    created() {\n      setTimeout(() => this.show = true);\n    },\n    methods: {\n      async delComment(commentId) {\n        const { id, commentType, playNow } = this;\n        const { comments } = [playNow][commentType];\n        try {\n          const confirm = await this.$confirm('确认删除？');\n          if (confirm !== 'confirm') {\n            return;\n          }\n          const cb = () => {\n            comments.hot = comments.hot.filter((item) => item.commentId !== commentId);\n            comments.latest = comments.latest.filter((item) => item.commentId !== commentId);\n            comments.total -= 1;\n            this.$store.dispatch(['updateSongDetail'][commentType], { id, comments });\n            this.$message.success('删除成功');\n          };\n          if (this.platform === 'qq') {\n            return request({\n              api: 'QQ_COMMENT_DELETE',\n              data: { id: commentId }\n            }).then(cb, () => this.$message.error('删除失败'));\n          }\n          const res = await request({\n            api: 'COMMENT',\n            data: {\n              t: 0,\n              type: commentType,\n              id,\n              commentId,\n            },\n            cache: true,\n          });\n          (res.code === 200) ? cb() : this.$message.error('删除失败');\n        } catch (err) {\n          console.log(err);\n        }\n      },\n      async reply(beReplied) {\n        const { commentId, user } = beReplied;\n        const { id, platform } = this;\n        this.$store.dispatch('updateCommentInfo', { type: 0, id, commentId, open: true, nick: user.nickname, beReplied, platform });\n      },\n      // 获取评论\n      getComments(init) {\n        const { playNow, commentType } = this;\n        const { comments, id } = [playNow][commentType];\n        if (!comments) {\n          return false;\n        }\n        let { offset, total } = comments;\n        if (init) {\n          offset = 0;\n        }\n        const limit = 20;\n        if (((offset + limit) > total) || this.loading) {\n          return;\n        }\n        this.loading = true;\n\n        init && (comments.latest = []);\n        if (this.platform === 'qq') {\n          request({\n            api: 'QQ_GET_COMMENT',\n            data: {\n              id: playNow.songid,\n              pageNo: offset / 20 + 1,\n            },\n          }).then((res) => {\n            comments.offset += limit;\n            comments.total = res.data.comment.commenttotal;\n            comments.latest = [ ...comments.latest, ...handleQQComments(res.data.comment.commentlist)];\n            this.$store.dispatch(['updateSongDetail'][commentType], { id, comments });\n            this.loading = false;\n          })\n        } else {\n          request({\n            api: ['MUSIC_COMMENTS'][commentType],\n            data: { offset, limit: 20, total, id }\n          }).then((res) => {\n            comments.offset += limit;\n            comments.total = res.total;\n            comments.latest = [ ...comments.latest, ...res.comments ];\n            this.loading = false;\n            this.$store.dispatch(['updateSongDetail'][commentType], { id, comments });\n          })\n        }\n      },\n      onScroll() {\n        const { comments, loading } = this;\n        if (!comments) {\n          return;\n        }\n        const { offset, total } = comments;\n        const el = $('.comments-page-container');\n        const viewH = el.height(); // 可见高度\n        const contentH = el.get(0).scrollHeight; // 内容高度\n        const scrollTop = el.scrollTop(); // 滚动高度\n        if (contentH - viewH - scrollTop < 300 && offset < total && !loading) {\n          this.getComments();\n        }\n      },\n      getTime(t) {\n        return timer(t).str('YY-MM-DD HH:mm:ss');\n      },\n      numberHandle: numToStr,\n      likeComment(c, type) {\n        const { playNow, commentType } = this;\n        const t = Number(!c.liked);\n        const cb = () => {\n          const comment = [playNow][commentType].comments[type].find((cItem) => cItem.commentId === c.commentId);\n          comment.likedCount += t * 2 - 1;\n          comment.liked = !c.liked;\n          comment.newLike = !c.liked ? '' : 'new-like';\n          this.$store.dispatch(['updateSongDetail'][commentType], playNow);\n        }\n        if (this.platform === 'qq') {\n          if (Storage.get('haveQCookie') !== '1') {\n            return this.$message.warning('请先前往设置页设置 Cookie');\n          }\n          return request({\n            api: 'QQ_COMMENT_LIKE',\n            data: {\n              id: c.commentId,\n              type: t * -1 + 2,\n            }\n          }).then(cb)\n        }\n        request({\n          api: 'LIKE_COMMENT',\n          data: {\n            t,\n            type: commentType,\n            cid: c.commentId,\n            id: this.id,\n          }\n        }).then((res) => {\n          res && cb();\n        })\n      },\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  .comments-page-container {\n    width: 40%;\n    position: absolute;\n    height: calc(100% - 50px);\n    left: 110%;\n    overflow: auto;\n    background: #0001;\n    border-left: 1px solid #fff8;\n    transition: 0.3s;\n    opacity: 0;\n\n\n    &.show {\n      left: 60%;\n      opacity: 1;\n    }\n\n    &::-webkit-scrollbar {\n      width: 0;\n      height:8px;\n      background-color:rgba(0,0,0,0);\n    }\n\n    .comment-type-block {\n      .comment-type-title {\n        height: 20px;\n        font-size: 100px;\n        color: #fff2;\n        font-weight: bold;\n      }\n\n      .comments-list {\n        padding-top: 50px;\n        .comment-item {\n          margin-bottom: 10px;\n          color: #fffa;\n          padding: 15px 10px;\n          background: #0002;\n          width: calc(100% - 60px);\n          margin-left: 20px;\n          border-radius: 10px;\n          transition: 0.5s;\n\n          &:hover {\n            background: #0004;\n            color: #fff;\n          }\n\n          .user-avatar {\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            margin-top: 5px;\n          }\n\n          .comment-content {\n            width: calc(100% - 80px);\n            display: inline-block;\n            vertical-align: top;\n            padding-left: 20px;\n\n            .user-name {\n              cursor: pointer;\n              &:hover {\n                text-decoration: underline;\n              }\n            }\n\n            .user-name-block {\n              font-weight: bold;\n              font-size: 18px;\n              opacity: 0.7;\n\n              .comment-time {\n                font-size: 12px;\n                font-weight: normal;\n              }\n            }\n            .content {\n              margin-top: 10px;\n              opacity: 0.7;\n            }\n            .be-replied {\n              margin-top: 5px;\n              padding: 5px 10px;\n              border-left: 5px solid #fff8;\n              opacity: 0.7;\n            }\n          }\n\n          .iconfont.new-like {\n            animation: likeAnimation 0.5s;\n\n            @keyframes likeAnimation {\n              from, to {\n                transform: rotate(0deg);\n              }\n              50% {\n                transform: rotate(-30deg);\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CommentComponent.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CommentComponent.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CommentComponent.vue?vue&type=template&id=70cb985a&scoped=true&\"\nimport script from \"./CommentComponent.vue?vue&type=script&lang=js&\"\nexport * from \"./CommentComponent.vue?vue&type=script&lang=js&\"\nimport style0 from \"./CommentComponent.vue?vue&type=style&index=0&id=70cb985a&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"70cb985a\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div>\n    <CommentComponent :platform=\"playNow.platform || '163'\" :comment-type=\"0\" :id=\"playNow.id\" :comments=\"comments\" />\n\n    <SendComment :type=\"0\" :platform=\"playNow.platform || '163'\" :success-cb=\"initComments\" />\n  </div>\n</template>\n\n<script>\n  import { mapGetters } from 'vuex';\n  import request from '../assets/utils/request';\n  import timer from '../assets/utils/timer';\n  import SendComment from '../components/SendComment';\n  import CommentComponent from '../components/CommentComponent';\n  import $ from 'jquery';\n  export default {\n    name: \"Comment\",\n    components: { SendComment, CommentComponent },\n    data() {\n      return {\n        comments: null,\n        loading: false,\n        type: ['hot', 'latest'],\n        show: false,\n      }\n    },\n    computed: {\n      ...mapGetters({\n        playNow: 'getPlaying',\n        user: 'getUser',\n      })\n    },\n    watch: {\n      playNow({ comments }) {\n        this.comments = comments;\n      }\n    },\n    created() {\n      this.comments = this.playNow.comments;\n      this.$store.dispatch('updateCommentInfo', { type: 0, id: 0, val: '', title: '', open: false });\n    },\n    methods: {\n      initComments() {\n        this.$message.success('发送成功~');\n        this.$store.dispatch('updateCommentInfo', { type: 0, id: 0, val: '', title: '', open: false, success: true, });\n      },\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Comment.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Comment.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Comment.vue?vue&type=template&id=24fbdada&scoped=true&\"\nimport script from \"./Comment.vue?vue&type=script&lang=js&\"\nexport * from \"./Comment.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"24fbdada\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CommentComponent.vue?vue&type=style&index=0&id=70cb985a&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CommentComponent.vue?vue&type=style&index=0&id=70cb985a&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SendComment.vue?vue&type=style&index=0&id=fe07b3e8&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SendComment.vue?vue&type=style&index=0&id=fe07b3e8&lang=scss&scoped=true&\""],"sourceRoot":""}